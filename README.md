# Font Manager

SillyTavern용 고급 폰트 관리 확장 프로그램입니다. 다양한 폰트를 쉽게 관리하고 적용할 수 있도록 도와줍니다.

## 📋 목차

- [주요 기능](#주요-기능)
- [설치 방법](#설치-방법)
- [사용 방법](#사용-방법)
- [기능 설명](#기능-설명)
- [슬래시 커맨드](#슬래시-커맨드)
- [설정 파일](#설정-파일)
- [문제 해결](#문제-해결)
- [라이선스](#라이선스)

## 🎯 주요 기능

### ✨ 폰트 관리
- **UI 폰트**: 인터페이스 요소의 폰트 변경
- **메시지 폰트**: 채팅 메시지의 폰트 변경
- **다국어 폰트 지원**: 영어, 한국어, 일본어, 중국어별 개별 폰트 설정
- **로컬 폰트 등록**: `/public/webfonts` 폴더의 woff2 파일을 쉽게 등록 (권장 ⭐)
- **폰트 파일 업로드**: woff2, woff, ttf, otf 파일을 Base64로 변환하여 사용
- **외부 URL 폰트**: @font-face 규칙을 통한 외부 CDN 폰트 추가

### 🎨 세밀한 조절
- 폰트 크기 조절 (10px ~ 25px)
- 폰트 굵기 조절 (webkit-text-stroke)
- 줄 간격 조절 (line-height)
- 입력창 전용 폰트 크기 설정

### 📝 마크다운 커스텀
- **대화문**: "따옴표"로 둘러싸인 텍스트에 개별 폰트 적용
- **이탤릭체**: *별표 하나*로 둘러싸인 텍스트에 개별 폰트 적용
- **밑줄**: __밑줄__로 둘러싸인 텍스트에 개별 폰트 적용
- **강조**: **별표 둘**로 둘러싸인 텍스트에 개별 폰트 적용
- 각 마크다운 요소별로 폰트와 크기 독립적으로 설정 가능

### 🏷️ 태그 커스텀
- 사용자 정의 태그에 특정 폰트 적용 (예: `<MEMO>메모 내용</MEMO>`)
- 태그별 폰트와 크기 개별 설정
- 대소문자 구분 없이 작동 (MEMO, Memo, memo 모두 동일)

### 📦 프리셋 시스템
- 폰트 조합을 프리셋으로 저장
- 프리셋 간 빠른 전환
- 프리셋 이름 수정 및 삭제

### 🎭 테마 연동
- 테마별 자동 폰트 적용
- 테마 변경 시 자동 프리셋 전환
- 사용자 정의 테마 규칙 설정

### 💾 백업 및 복원
- **프리셋 내보내기**: 현재 선택된 프리셋과 관련 폰트만 내보내기 (다른 사용자와 공유 시 유용)
- **전체 설정 내보내기**: 모든 폰트, 프리셋, 테마 연동 등 전체 설정 내보내기
- **설정 초기화**: 모든 설정을 기본값으로 되돌리기
- **충돌 없는 설정 병합**: 기존 설정과 충돌 없이 새로운 설정을 안전하게 병합
- **기존 파일 호환성**: 이전 버전의 백업 파일도 문제없이 불러오기 가능
- **다른 환경으로의 설정 이전 지원**: JSON 형태의 백업 파일

## 🚀 설치 방법

### 1. SillyTavern -> Extension 메뉴 -> Install extension -> Github 링크 입력

### 2. SillyTavern 재시작

확장을 설치한 후 SillyTavern을 재시작해주세요.

### 3. 확장 활성화

1. SillyTavern 실행
2. 좌측 하단의 요술봉 메뉴 (🪄) 클릭
3. "폰트 관리" 항목 확인

## 📖 사용 방법

### 기본 사용법

1. **폰트 매니저 열기**
   - 확장 메뉴에서 "폰트 관리" 클릭
   - 또는 슬래시 커맨드 `/font` 사용

2. **폰트 매니저 활성화**
   - "폰트 매니저 활성화" 체크박스 선택

3. **폰트 추가**
   - 방법 1 (권장): `/public/webfonts` 폴더에 woff2 파일을 넣고 "로컬 폰트 등록" 버튼 클릭
   - 방법 2: "파일 선택"으로 폰트 파일을 직접 업로드
   - 방법 3: 외부 URL의 CSS @font-face 규칙 입력 후 "가져오기" 클릭

4. **폰트 적용**
   - UI 폰트 또는 메시지 폰트 드롭다운에서 폰트 선택
   - 조절바를 사용하여 크기 및 굵기 조절

5. **설정 백업 (권장)**
   - 설정 완료 후 "설정 내보내기"로 백업 파일 생성
   - 현재 선택된 프리셋까지 함께 백업됨

### 폰트 추가 방법

#### 방법 1: 로컬 폰트 등록 (권장 ⭐)

1. SillyTavern 설치 폴더의 `/public/webfonts` 폴더에 woff2 폰트 파일 복사
2. "로컬 폰트 등록" 버튼 클릭
3. 폰트 파일명 입력 (확장자 제외, 예: MyFont)
4. 폰트 표시 이름 입력 (폰트 목록에 표시될 이름)
5. 자동으로 폰트가 등록됨

**장점**:
- ✅ 브라우저 저장소 용량을 차지하지 않음
- ✅ 폰트 변경 시 버벅임 없음
- ✅ 큰 폰트 파일도 문제없이 사용 가능
- ✅ 서버에서 직접 로드하여 빠른 성능

**지원 형식**: woff2 권장 (가장 작은 파일 크기, 최신 브라우저 지원)

#### 방법 2: 폰트 파일 직접 업로드

1. "파일 선택" 버튼 클릭
2. 폰트 파일 선택 (woff2, woff, ttf, otf)
3. "업로드" 버튼 클릭
4. 폰트 이름 입력 (모달 팝업에서)
5. 자동으로 폰트가 등록됨

**지원 형식**: woff2, woff, ttf, otf
- **woff2 권장**: 가장 작은 파일 크기
- **ttf**: 가장 호환성이 좋지만 파일 크기 큼 (woff2의 약 2-3배)
- **woff**: woff2보다 크지만 구형 브라우저 지원
- **otf**: ttf와 유사한 크기

**최대 크기**: 10MB  
**저장 방식**: Base64 Data URL로 변환하여 브라우저 저장소에 저장  
**주의**: 큰 파일은 저장소 용량을 많이 차지하고 버벅임이 발생할 수 있음

#### 방법 3: 외부 URL로 가져오기

외부 CDN에 호스팅된 폰트를 사용하는 경우:

```css
@font-face {
    font-family: 'Pretendard-Regular';
    src: url('https://fastly.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff');
    font-weight: 400;
    font-style: normal;
}
```

"외부 URL로 가져오기" 섹션에 위 코드를 붙여넣고 "가져오기" 버튼 클릭

## 🛠 기능 설명

### 프리셋 관리

- **저장**: 현재 폰트 설정을 프리셋으로 저장
- **수정**: 프리셋 이름 변경
- **삭제**: 불필요한 프리셋 제거
- **추가**: 새로운 빈 프리셋 생성

### 마크다운 커스텀

마크다운 커스텀을 활성화하면 메시지 내 마크다운 요소별로 다른 폰트를 적용할 수 있습니다:

1. **"마크다운 커스텀 활성화" 체크박스 선택**
2. **각 요소별 폰트 설정**:
   - **대화문** (q, blockquote): "따옴표"로 둘러싸인 텍스트
   - **이탤릭체** (em): *별표 하나*로 둘러싸인 텍스트
   - **밑줄** (u): __밑줄__로 둘러싸인 텍스트
   - **강조** (strong): **별표 둘**로 둘러싸인 텍스트
3. **폰트와 크기를 개별적으로 설정**

예시:
```
"안녕하세요" → 대화문 폰트 적용
*생각 중...* → 이탤릭체 폰트 적용
__중요__ → 밑줄 폰트 적용
**강조!** → 강조 폰트 적용
```

### 태그 커스텀

사용자가 정의한 태그에 특정 폰트를 적용할 수 있습니다:

1. **"태그 커스텀 활성화" 체크박스 선택**
2. **태그 추가**:
   - 태그 이름 입력 (예: MEMO, NOTE, THOUGHT)
   - 폰트 선택
   - 폰트 크기 설정
   - "태그 추가" 버튼 클릭
3. **메시지에서 사용**:
   ```
   <MEMO>이것은 메모입니다</MEMO>
   <NOTE>노트 내용</NOTE>
   ```

**특징**:
- 대소문자 구분 없음 (`<MEMO>`, `<memo>`, `<Memo>` 모두 동일)
- 여러 태그를 동시에 사용 가능
- 각 태그마다 다른 폰트와 크기 설정 가능

### 다국어 폰트

다국어 폰트를 활성화하면 각 언어별로 다른 폰트를 적용할 수 있습니다:

- **영어**: 라틴 문자 (U+0020-007F, U+00A0-00FF, etc.)
- **한국어**: 한글 (U+1100-11FF, U+3130-318F, U+AC00-D7AF, etc.)
- **일본어**: 히라가나/가타카나 (U+3040-309F, U+30A0-30FF, etc.)
- **중국어**: 한자 (U+4E00-9FFF, U+3400-4DBF, etc.)

### 테마 연동

1. 테마 이름 입력
2. 연동할 프리셋 선택
3. "테마 연동 추가" 클릭

테마가 변경되면 자동으로 설정된 프리셋이 적용됩니다.

## 💬 슬래시 커맨드

### `/font`
폰트 관리 창을 엽니다.

```
/font
```

### `/font-debug`
디버깅 정보를 콘솔에 출력합니다.

```
/font-debug
```

## 📄 설정 파일

설정은 브라우저의 localStorage에 자동 저장됩니다:

- **키**: `font-manager-settings`
- **형식**: JSON
- **내용**: 폰트 목록, 프리셋, 테마 규칙 등

### 백업 및 복원

#### 📤 프리셋 내보내기
현재 선택된 프리셋과 관련된 폰트만 내보냅니다. 다른 사용자와 특정 프리셋을 공유할 때 유용합니다.

1. 내보낼 프리셋을 선택
2. "프리셋 내보내기" 버튼 클릭
3. JSON 파일 자동 다운로드
4. 파일명 형식: `font-manager-preset-[프리셋명]-YYYYMMDD-HHMM.json`

**포함 내용**:
- 선택된 프리셋의 모든 설정
- 프리셋에서 사용 중인 폰트 정보만

#### 📤 전체 설정 내보내기
모든 폰트, 프리셋, 테마 연동 등 전체 설정을 내보냅니다.

1. "전체 설정 내보내기" 버튼 클릭
2. JSON 파일 자동 다운로드
3. 파일명 형식: `font-manager-settings-YYYYMMDD-HHMM.json`

**포함 내용**:
- 모든 폰트 목록
- 모든 프리셋
- 테마 연동 규칙
- 현재 선택된 프리셋 정보

#### 📥 설정 불러오기 (스마트 병합)
1. "설정 불러오기" 버튼 클릭
2. JSON 파일 선택 (프리셋 파일 또는 전체 설정 파일)
3. **자동 병합 처리**:
   - 폰트 목록: 이름 중복 제거하여 기존 폰트와 병합
   - 프리셋: 이름 중복 제거하여 기존 프리셋과 병합
   - 테마 연동: 테마 이름 중복 제거하여 기존 규칙과 병합
   - 프리셋 파일인 경우: 해당 프리셋 자동 선택
   - 전체 설정 파일인 경우: 파일에 저장된 프리셋 자동 선택

#### 🔄 설정 초기화
모든 설정을 기본값으로 되돌립니다.

1. "설정 초기화" 버튼 클릭
2. 확인 대화상자에서 "확인" 클릭
3. 모든 폰트, 프리셋, 설정이 삭제됨

**경고**: 이 작업은 되돌릴 수 없습니다. 초기화 전에 백업을 권장합니다.

#### 🔄 호환성
- **v2.0 형식**: 프리셋/전체 설정 분리, 현재 선택된 프리셋 정보 포함
- **v1.0 형식**: 기존 백업 파일도 완벽 호환

## 🔧 문제 해결

### 폰트가 적용되지 않는 경우

1. **폰트 매니저 활성화 확인**
   - 설정에서 "폰트 매니저 활성화"가 체크되어 있는지 확인

2. **폰트 URL 확인**
   - 폰트 파일 URL이 유효한지 확인
   - CORS 정책으로 인해 일부 외부 폰트가 차단될 수 있음

3. **CSS 문법 확인**
   - @font-face 규칙이 올바른 CSS 문법인지 확인

4. **브라우저 캐시 삭제**
   - 브라우저 캐시를 삭제하고 페이지 새로고침

### 로컬 폰트 등록 문제

1. **로컬 폰트가 로드되지 않음**
   - `/public/webfonts` 폴더에 폰트 파일이 올바르게 위치했는지 확인
   - 파일명이 정확한지 확인 (대소문자 구분)
   - SillyTavern 재시작 후 다시 시도
   - 브라우저 콘솔(F12)에서 404 에러 확인

2. **폰트 파일 경로 문제**
   - 파일이 `/public/webfonts/파일명.woff2` 경로에 있는지 확인
   - 올바른 경로: `SillyTavern 설치폴더/public/webfonts/`

### 파일 업로드 문제

1. **파일 처리 실패**
   - 파일 형식 확인 (woff2, woff, ttf, otf 지원)
   - 파일 크기 확인 (10MB 이하)
   - 브라우저가 FileReader API를 지원하는지 확인
   - 손상된 파일이 아닌지 확인

2. **업로드한 폰트가 적용되지 않음**
   - 폰트 매니저가 활성화되어 있는지 확인
   - 브라우저 캐시 삭제 및 새로고침
   - 브라우저 콘솔(F12)에서 오류 메시지 확인

3. **파일이 너무 커서 느림**
   - **로컬 폰트 등록 방식 사용 권장** (방법 1)
   - **ttf/otf 파일은 woff2로 변환 권장** (크기가 2-3배 작음)
   - 온라인 변환 도구: [font-converter.net](https://font-converter.net/)
   - 폰트 서브셋 사용으로 파일 크기 감소

4. **localStorage 용량 초과**
   - 브라우저의 localStorage는 5-10MB 제한
   - 사용하지 않는 폰트 삭제
   - **로컬 폰트 등록 방식 사용** (저장소를 차지하지 않음)

### 설정이 저장되지 않는 경우

1. **로컬 스토리지 확인**
   - 브라우저의 로컬 스토리지가 활성화되어 있는지 확인

2. **시크릿 모드 사용 금지**
   - 시크릿/인코그니토 모드에서는 설정이 저장되지 않음

### 설정 불러오기 문제

1. **파일 형식 확인**
   - JSON 파일인지 확인 (.json 확장자)
   - 파일 크기가 10MB 이하인지 확인

2. **병합 결과 확인**
   - 콘솔(F12)에서 병합 과정 로그 확인
   - 중복된 이름의 항목들은 자동으로 제외됨

3. **프리셋 자동 선택 안됨**
   - v1.0 형식 파일은 프리셋 자동 선택 기능 없음
   - v2.0 형식 파일만 현재 선택된 프리셋 정보 포함

### 성능 이슈

1. **과도한 폰트 사용 주의**
   - 너무 많은 폰트를 동시에 로드하면 성능 저하 가능

2. **폰트 파일 크기 확인**
   - 큰 폰트 파일은 로딩 시간이 길어질 수 있음

## 📊 파일 구조

```
Font-Manager/
├── README.md          # 이 파일
├── manifest.json      # 확장 메타데이터
├── index.js          # 메인 로직
├── style.css         # 스타일시트
├── template.html     # UI 템플릿
└── button.html       # 메뉴 버튼 템플릿
```

## 🎨 커스터마이징

### CSS 변수

확장에서 사용하는 주요 CSS 변수들:

```css
:root {
  --font-manager-ui-size: 14px;
  --font-manager-ui-weight: 0px;
  --font-manager-chat-size: 14px;
  --font-manager-input-size: 14px;
  --font-manager-chat-weight: 0px;
  --font-manager-chat-line-height: 1.2rem;
}
```

## 🤝 기여하기

프로젝트 개선을 위한 기여를 환영합니다!

1. 이슈 리포트
2. 기능 제안
3. 코드 기여
4. 문서 개선

## 📝 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다.

## 🙏 감사의 말

- SillyTavern 개발팀
- 오픈소스 폰트 제작자들
- 커뮤니티 기여자들

---

**Font Manager**로 더욱 개성 있는 채팅 환경을 만들어보세요! 🎨✨ 